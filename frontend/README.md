# Angular frontend single-page client applications

## @openapitools/openapi-generator-cli

Automated models and services are generated by @openapitools/openapi-generator-cli based on the
OAS 3.x schema generated by `spectacular`.

See [this tutorial](https://www.kevinboosten.dev/how-i-use-an-openapi-spec-in-my-angular-projects).

### Steps to build it

#### Start with a new app module. In ng 18+ you have to explicitly say you want an app.module:

```
ng new --standalone false oas-angular-app
```

#### Install the openapi-generator-cli:

```
npm i @openapitools/openapi-generator-cli -D
```

Note that [openapi-generator](https://github.com/OpenAPITools/openapi-generator) is a Jave app
so you may have to install and/or upgrade your JRE.

Here's how I did it for MacOS:

```
brew tap AdoptOpenJDK/openjdk
brew install --cask adoptopenjdk11
which java
export JAVA_HOME=`/usr/libexec/java_home -v 1.11`
java -version
openjdk version "11.0.11" 2021-04-20
OpenJDK Runtime Environment AdoptOpenJDK-11.0.11+9 (build 11.0.11+9)
```

#### Add a build script to run openapi-generator.  Add this to `package.json`:

```diff
diff --git a/frontend/oas-angular-app/package.json b/frontend/oas-angular-app/package.json
index 7b76dd3..9aaa370 100644
--- a/frontend/oas-angular-app/package.json
+++ b/frontend/oas-angular-app/package.json
@@ -6,7 +6,9 @@
     "start": "ng serve",
     "build": "ng build",
     "watch": "ng build --watch --configuration development",
-    "test": "ng test"
+    "test": "ng test",
+    "generate:api": "openapi-generator-cli generate -p=removeOperationIdPrefix=true -i ../../docs/schemas/openapi.yaml -g typescript-angular -o src/app/core/api/v1"
   },
```


#### Generate the API client code:

```
npm run generate:api
```

#### Make some components

```
mkdir src/app/components
cd src/app/components
ng generate component CourseList
ng generate component CourseDetail
```

Here's a very basic example:

```typescript
// app/components/course-list/course-list.component.ts
import { Component, OnInit } from '@angular/core';
import { CoursesService, Course } from '../../core/api/v1';

@Component({
  selector: 'app-course-list',
  templateUrl: './course-list.component.html',
  styleUrl: './course-list.component.css'
})
export class CourseListComponent implements OnInit {
  courses: any;

  constructor(private coursesService: CoursesService) {}

  ngOnInit() {
    this.coursesService.coursesList().subscribe(
      (courses) => {
        this.courses = courses;
        console.log(this.courses)
      },
      (error) => console.error('Error:', error)
    );
  }
}
```

Unlike `jsona` this package doesn't know the details of a JSONAPI.org spec so you need to drill down into the
response a bit in this example:

```html
<!-- app/components/course-list/course-list.component.html -->
<h2>Course List</h2>
Page {{ courses.meta.pagination.page }} (length {{courses.data.length }}) of {{ courses.meta.pagination.pages }}
<ul>
  <li *ngFor="let course of courses.data">
    <a [routerLink]="['/courses', course.id]">{{ course.attributes.course_identifier }}</a>:
      {{ course.attributes.course_name }}
  </li>
</ul>

```

#### Add OAuth2

[angular-auth-oidc-client](https://angular-auth-oidc-client.com/docs/intro) works with Angular 18 which is the
latest version at the time of this writing.

Per the [Quickstart](https://angular-auth-oidc-client.com/docs/intro) we can use the configuration wizard
to set stuff up:

```
oas-angular-app$ ng add angular-auth-oidc-client

âœ” Determining Package Manager
  â€º Using package manager: npm
âœ” Searching for compatible package version
  â€º Found compatible package version: angular-auth-oidc-client@18.0.2.
âœ” Loading package information from registry
âœ” Confirming installation
âœ” Installing package
? What flow to use? OIDC Code Flow PKCE using refresh tokens
? Please enter your authority URL or Azure tenant id or Http config URL http://localhost:8000/o/.well-known/openid-configuration/
    ğŸ” Running checks...
    âœ…ï¸ Project found, working with 'oas-angular-app'
    âœ…ï¸ Added "angular-auth-oidc-client" 18.0.2
    ğŸ” Installing packages...
    âœ…ï¸ Installed
    âœ…ï¸ 'src/app/auth/auth-config.module.ts' will be created
    âœ…ï¸ 'AuthConfigModule' is imported in 'src/app/app.module.ts'
    âœ…ï¸ All imports done, please add the 'RouterModule' as well if you don't have it imported yet.
    âœ…ï¸ No silent-renew entry in assets array needed
    âœ…ï¸ No 'silent-renew.html' needed
CREATE src/app/auth/auth-config.module.ts (753 bytes)
UPDATE package.json (1311 bytes)
UPDATE src/app/app.module.ts (1153 bytes)
âœ” Packages installed successfully.

```

Then edit `src/app/auth/auth-config.module.ts` to fill in the ClientId, Scopes, etc.

**N.B** Because this library implements OAuth2 best practices, there is no ClientSecret. Change the existing
setup to remove the secret.

Follow the [Code flow PKCE auto-login](https://github.com/damienbod/angular-auth-oidc-client/tree/main/projects/sample-code-flow-auto-login-all-routes)
example (found in the [samples library](https://angular-auth-oidc-client.com/docs/samples/) to get things working.

#### Some Notes

JSONAPI `filter` and `include` parameters work, subject to the level of detail provided in the OAS schema
generated by `spectacular`: For example, trying `include=course_terms,course_terms.instructors` won't work
because the OAS schema doesn't recursively descend all the possible include paths so includes are basically
limited to one level.




